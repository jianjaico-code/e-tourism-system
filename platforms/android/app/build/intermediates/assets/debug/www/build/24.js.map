{"version":3,"sources":["../../src/pages/edit-rating/edit-rating.module.ts","../../src/pages/edit-rating/edit-rating.ts"],"names":[],"mappings":"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","file":"24.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { EditRatingPage } from './edit-rating';\n\n@NgModule({\n  declarations: [\n    EditRatingPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(EditRatingPage),\n  ],\n})\nexport class EditRatingPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/edit-rating/edit-rating.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController, ViewController } from 'ionic-angular';\nimport * as firebase from 'firebase';\nimport { AngularFireAuth } from 'angularfire2/auth';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-edit-rating',\n  templateUrl: 'edit-rating.html',\n})\nexport class EditRatingPage {\n\n  name;\n  rate: boolean = false;\n  key;\n  ratings: Array<any>;\n  loadedRatings: Array<any>;\n  averageRate;\n  dateTodaty = new Date();\n  peopleRated;\n  userRestricted: boolean;\n \n\n  constructor(public navCtrl: NavController, public afAuth: AngularFireAuth, public viewCtrl: ViewController, public alertCtrl: AlertController, public navParams: NavParams) {\n    this.name = this.navParams.data.name;\n    this.key = this.navParams.data.key;\n\n    console.log(this.dateTodaty);\n    this.initRating();\n  }\n\n  exit(){\n    this.viewCtrl.dismiss();\n  }\n\n  initRating(){\n    if(this.navParams.data.userEmail == this.afAuth.auth.currentUser.email){\n      this.userRestricted = true;\n    }else{this.userRestricted = false}\n\n    let ref = firebase.database().ref('user/')\n    let ratingRef = firebase.database().ref('rating');\n    let user;\n\n    ref.on('value', data => {\n      data.forEach(data => {\n        user = data.val();\n      });\n      ratingRef.on('value', data => {\n        let tmp = [];\n        data.forEach(data => {\n          if(user.email == data.val().email){\n            if(data.val().establishmentName == this.name){\n              this.rate = true;\n              tmp.push({\n                key: data.key,\n                establishmentName: data.val().establishmentName,\n                email: data.val().email,\n                rating: data.val().rating,\n                comments: data.val().comments,\n                profilePic: user.profilePicUrl\n              });\n            }\n          }\n        });\n        this.ratings = tmp.reverse();\n        this.loadedRatings = tmp;\n        this.peopleRated = this.ratings.length;\n        this.getAverageRating();\n        // this.setNewData();\n      });\n    });\n  }\n\n  initializeItem(): void{\n    this.ratings = this.loadedRatings;\n  }\n\n  getItems(searchbar){\n    this.initializeItem();\n    let q = searchbar.srcElement.value;\n\n    if(!q){\n      return;\n    }\n\n    this.ratings = this.ratings.filter(data => {\n      if(data.email && q){\n        if(data.email.toLowerCase().indexOf(q.toLowerCase()) > -1){\n          return true;\n        }\n        return false;\n      }\n    });\n  }\n\n  removeRating(data){\n    let ref = firebase.database().ref('rating/' + data);\n    let alert = this.alertCtrl.create({\n      message: 'Are you sure you want to delete this rating?',\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel',\n          handler: () => {\n            console.log('Cancel Clicked');\n          }\n        },\n        {\n          text: 'Yes',\n          handler: () => { \n             ref.remove();\n          }\n        }\n      ]\n    });\n    alert.present();\n  }\n\n  getAverageRating(){\n    let rating = [];\n    this.ratings.map(data =>{\n      return rating.push(data.rating);\n    });\n\n    if(rating.length == 0){ this.averageRate = 0;}\n    else {\n      let rate = rating.reduce((total, score) => total + score) / rating.length;\n      this.averageRate = Math.round(rate);\n    }\n  }\n\n  setNewData(){\n    let ref = firebase.database().ref('establishment/' + this.key);\n    ref.set({\n      name: this.navParams.data.name,\n      address: this.navParams.data.address,\n      description: this.navParams.data.description,\n      phone: this.navParams.data.phone,\n      latitude: this.navParams.data.latitude,\n      longitude: this.navParams.data.longitude,\n      website: this.navParams.data.website,\n      category: this.navParams.data.category,\n      status:  this.navParams.data.status,\n      images: this.navParams.data.imageurl,\n      averageRate: this.averageRate,\n      peopleRated: this.peopleRated\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/edit-rating/edit-rating.ts"],"sourceRoot":""}
{"version":3,"sources":["../../src/pages/message-list-tourist/message-list-tourist.module.ts","../../src/pages/message-list-tourist/message-list-tourist.ts"],"names":[],"mappings":"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","file":"17.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MessageListTouristPage } from './message-list-tourist';\n\n@NgModule({\n  declarations: [\n    MessageListTouristPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MessageListTouristPage),\n  ],\n})\nexport class MessageListTouristPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/message-list-tourist/message-list-tourist.module.ts","import { Component } from '@angular/core';\nimport { Platform, IonicPage, NavController, NavParams, AlertController, ModalController } from 'ionic-angular';\nimport * as firebase from 'firebase';\nimport { AngularFireAuth } from 'angularfire2/auth';\n\n@IonicPage()\n@Component({\n  selector: 'page-message-list-tourist',\n  templateUrl: 'message-list-tourist.html',\n})\nexport class MessageListTouristPage {\n\n  public items: any[] = [];\n\n  mobile;\n  recepient: Array<any>;\n  message;\n  chat;;\n  senderEmail;\n  recieverEmail;\n  key;\n  userData;\n\n  constructor(public platform: Platform, public modalCtrl: ModalController, public navCtrl: NavController, public navParams: NavParams, private afAuth: AngularFireAuth, private alertCtrl: AlertController) {\n    if(this.platform.is('mobile')){\n      this.mobile = true;\n    }\n    else{\n      this.mobile = false;\n    }\n\n    this.userData = \"\";\n    this.key = afAuth.auth.currentUser.uid;\n    this.senderEmail = afAuth.auth.currentUser.email;\n    this.getMessageRecepient();\n\n    setTimeout(() => {\n      for (let i = 0; i < 100; i++) {\n        this.items[i] = i\n      }\n    }, 300);\n  }\n\n  callFunction(){\n    let element = document.getElementById(\"messageBox\");\n    element.scrollTop = element.scrollHeight - element.clientHeight;\n  }\n\n  messageOwner(data){\n    let modal = this.modalCtrl.create('TouristMessageToBusinessmanPage',  data);\n    modal.present();\n  }\n\n  getMessageRecepient(){\n    let ref = firebase.database().ref('Tourist-Message-Log/' + this.key);\n    let user = firebase.database().ref('user');\n\n    ref.on('value', data => {\n      data.forEach(data => {\n        \n        if(this.key == data.val().myKey){\n          user.on('value', user => {\n            let arr = [];\n            user.forEach(user => {\n             if(user.key == data.val().key){\n              let dateData = new Date( data.val().time);\n              let dateDMY = dateData.getMonth()+1 + \"/\" + dateData.getDate() + \"/\" + dateData.getFullYear();\n              let hours = dateData.getHours();\n              let ampm = hours >= 12 ? 'pm' : 'am';\n              hours = hours % 12;\n              hours = hours ? hours : 12; \n              var strTime = hours + ':' + (dateData.getMinutes()<10?'0':'') + dateData.getMinutes()  + ' ' + ampm;\n\n              arr.push({\n                image: user.val().profilePicUrl,\n                name: user.val().name,\n                userEmail: user.val().email,\n                userType: user.val().usertypeid,\n                key: user.key,\n                date: dateDMY,\n                time: strTime,\n                status: data.val().status\n              });\n             }\n            });\n            this.recepient = arr;\n          });\n        }\n      });\n    });\n  }\n\n  pushChat(key){\n    let ref = firebase.database().ref('user');\n    ref.on('value', data => {\n      data.forEach(data => {\n        if(key == data.key){\n          this.recieverEmail = data.key;\n          this.userData  = data.val();\n        }\n        if(data.key == this.afAuth.auth.currentUser.uid){\n          this.key = key;\n          let ref = firebase.database().ref('message/'+ key + '/' + this.afAuth.auth.currentUser.uid);\n          ref.on('value', data => {\n            let arr = [];\n            data.forEach(data => {\n              arr.push(data.val());\n            });\n            this.chat = arr;\n          });   \n        }\n      });\n    });\n  }\n\n  sendMessage(){\n    if(!this.message || this.message.length === 0 || /^\\s*$/.test(this.message)){\n      let alert = this.alertCtrl.create({\n        message: \"Its EMPTY\",\n        buttons: [\n          {\n            text: \"Ok\",\n            role: 'cancel'\n          }\n        ]\n      });\n      alert.present();\n    }\n    else{\n      if(this.userData == \"\"){\n        let alert2 = this.alertCtrl.create({\n          message: \"Please select a user you want to message\",\n          buttons: [\n            {\n              text:\"OK\",\n              role: 'cancel'\n            }\n          ]\n        });\n        alert2.present();\n      }\n      else{\n        let ref = firebase.database().ref('message/' +this.recieverEmail+'/' + this.afAuth.auth.currentUser.uid);\n        let TML = firebase.database().ref('Tourist-Message-Log/' + this.afAuth.auth.currentUser.uid + '/' + this.recieverEmail);\n        ref.push({\n          email: this.senderEmail,\n          message: this.message,\n          date: Date(),\n          usertypeid: this.userData.usertypeid\n        });\n        TML.set({\n          key: this.recieverEmail,\n          time: Date(),\n          status: false,\n          myKey: this.afAuth.auth.currentUser.uid\n        });\n        this.getMessageRecepient();\n      }\n    }\n    this.message = \"\";\n    this.getMessageRecepient();\n   }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/message-list-tourist/message-list-tourist.ts"],"sourceRoot":""}